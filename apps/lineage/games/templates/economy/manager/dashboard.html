{% extends "layouts/base.html" %}
{% load static i18n %}

{% block extrastyle %}
<style>
.mgr-bg { background: radial-gradient(ellipse at center, #1a1a2e 0%, #121220 100%); min-height: 100vh; padding: 30px 0; }
.card-glow { background: linear-gradient(to bottom right, #1a1a2e, #121220); border: 2px solid #6f42c1; border-radius: 12px; box-shadow: 0 0 15px rgba(111,66,193,.5), 0 0 25px rgba(13,202,240,.3); }
.monster-img { width: 40px; height: 40px; object-fit: cover; border-radius: 6px; margin-right: 8px; }
</style>
{% endblock %}

{% block content %}
<div class="mgr-bg">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4 text-white">
      <h3 class="m-0">{% trans "Gerenciar Batalha Mortal" %}</h3>
      <a href="{% url 'games:economy-game' %}" class="btn btn-outline-info rounded-pill">{% trans "Ver Jogo" %}</a>
    </div>

    <div class="row g-3">
      <div class="col-12 col-xl-5">
        <div class="card card-glow mb-3">
          <div class="card-header text-white-50">{% trans "Nova Recompensa Padrão (+10)" %}</div>
          <div class="card-body">
            <form method="post" class="row g-2">
              {% csrf_token %}
              <input type="hidden" name="action" value="set_reward" />
              <div class="col-9">{{ reward_form.item.label_tag }} {{ reward_form.item }}</div>
              <div class="col-3">{{ reward_form.amount.label_tag }} {{ reward_form.amount }}</div>
              <div class="col-12 text-end"><button class="btn btn-warning rounded-pill" type="submit">{% trans "Salvar" %}</button></div>
            </form>
            {% if reward %}
              <div class="mt-3 small text-white-50">{% trans "Atual:" %} {{ reward.item.name }} +{{ reward.item.enchant }} (x{{ reward.amount }})</div>
            {% endif %}
          </div>
        </div>

        <div class="card card-glow">
          <div class="card-header text-white-50">{% trans "Adicionar Monstro" %}</div>
          <div class="card-body">
            <form method="post" enctype="multipart/form-data" class="row g-2">
              {% csrf_token %}
              <input type="hidden" name="action" value="add_monster" />
              <div class="col-12">{{ monster_form.name.label_tag }} {{ monster_form.name }}</div>
              <div class="col-6">{{ monster_form.level.label_tag }} {{ monster_form.level }}</div>
              <div class="col-6">{{ monster_form.required_weapon_level.label_tag }} {{ monster_form.required_weapon_level }}</div>
              <div class="col-4">{{ monster_form.fragment_reward.label_tag }} {{ monster_form.fragment_reward }}</div>
              <div class="col-4">{{ monster_form.respawn_seconds.label_tag }} {{ monster_form.respawn_seconds }}</div>
              <div class="col-4">{{ monster_form.image.label_tag }} {{ monster_form.image }}</div>
              <div class="col-4">{{ monster_form.attack.label_tag }} {{ monster_form.attack }}</div>
              <div class="col-4">{{ monster_form.defense.label_tag }} {{ monster_form.defense }}</div>
              <div class="col-4">{{ monster_form.hp.label_tag }} {{ monster_form.hp }}</div>
              <div class="col-12 text-end"><button class="btn btn-primary" type="submit">{% trans "Adicionar" %}</button></div>
            </form>
          </div>
        </div>
      </div>

      <div class="col-12 col-xl-7">
        <div class="card card-glow h-100">
          <div class="card-header text-white-50">{% trans "Monstros" %}</div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-dark table-striped mb-0">
                <thead>
                  <tr>
                    <th>{% trans "Monstro" %}</th>
                    <th>{% trans "+Arma" %}</th>
                    <th>{% trans "Frag" %}</th>
                    <th>{% trans "Respawn(s)" %}</th>
                    <th class="text-end">{% trans "Ações" %}</th>
                  </tr>
                </thead>
                <tbody>
                  {% for m in monsters %}
                  <tr>
                    <td>
                      {% if m.image %}<img class="monster-img" src="{{ m.image.url }}" alt="" />{% endif %}
                      {{ m.name }} (Lv {{ m.level }})
                    </td>
                    <td>+{{ m.required_weapon_level }}</td>
                    <td>{{ m.fragment_reward }}</td>
                    <td>{{ m.respawn_seconds }}</td>
                    <td class="text-end">
                      <form method="post" enctype="multipart/form-data" class="d-inline-flex gap-2 align-items-center">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="update_monster" />
                        <input type="hidden" name="monster_id" value="{{ m.id }}" />
                        <input type="number" name="fragment_reward" value="{{ m.fragment_reward }}" class="form-control form-control-sm" style="max-width:90px" />
                        <input type="number" name="respawn_seconds" value="{{ m.respawn_seconds }}" class="form-control form-control-sm" style="max-width:110px" />
                        <button class="btn btn-primary btn-sm" type="submit">{% trans "Salvar" %}</button>
                      </form>
                      <form method="post" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="delete_monster" />
                        <input type="hidden" name="monster_id" value="{{ m.id }}" />
                        <button class="btn btn-outline-danger btn-sm" type="submit">{% trans "Remover" %}</button>
                      </form>
                    </td>
                  </tr>
                  {% empty %}
                  <tr><td colspan="5" class="text-center text-white-50 py-3">{% trans "Nenhum monstro cadastrado." %}</td></tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}


